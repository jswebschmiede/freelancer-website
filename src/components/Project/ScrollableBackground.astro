---
import { twMerge } from 'tailwind-merge';
import { getImage } from 'astro:assets';
import { Icon } from 'astro-icon/components';

interface Props {
  imageUrl: ImageMetadata;
  height?: string;
  alt: string;
  scrollSensitivity?: number;
  className?: string;
}

const { imageUrl, height = '600px', alt, scrollSensitivity = 1.0, className } = Astro.props;
const optimizedBackground = await getImage({
  src: imageUrl,
  loading: 'eager',
  format: 'webp',
});
---

<div
  class:list={twMerge(
    'scrollable-background-container group relative h-[400px] w-full cursor-none touch-none overflow-hidden lg:h-(--scrollable-background-height)',
    className
  )}
  style={`--scrollable-background-height: ${height};`}
  role="img"
  aria-label={alt}
  data-scrollable
  data-scroll-sensitivity={scrollSensitivity}
>
  <!-- Custom Cursor - Always visible when mouse is over container -->
  <div
    class="custom-cursor pointer-events-none absolute z-50 hidden -translate-x-1/2 -translate-y-1/2 md:block md:opacity-0 md:group-hover:opacity-100"
    data-custom-cursor
    style="left: -100px; top: -100px;"
  >
    <div
      class="btn btn-circle btn-primary bg-primary/50 border-primary/25 backdrop-blur-sm flex items-center justify-center shadow-sm"
      data-cursor-circle
    >
      <Icon name="mdi:arrow-up" class="h-5 w-5" data-arrow-up />

      <Icon name="mdi:eye" class="h-5 w-5" data-cursor-arrow />

      <Icon name="mdi:arrow-down" class="h-5 w-5" data-arrow-down />
    </div>
  </div>

  <div
    class="scrollable-background absolute w-full bg-size-[100%_auto] bg-center transition-transform duration-200 ease-out"
    style={`background-image: url(${optimizedBackground.src});`}
    data-image-height={optimizedBackground.attributes.height}
    data-image-width={optimizedBackground.attributes.width}
    data-scrollable-element
  >
  </div>
</div>
