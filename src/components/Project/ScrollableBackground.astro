---
import { getImage } from 'astro:assets';

interface Props {
	imageUrl: ImageMetadata;
	height?: string;
	alt: string;
	scrollSensitivity?: number;
}

const { imageUrl, height = '600px', alt, scrollSensitivity = 1.0 } = Astro.props;
const optimizedBackground = await getImage({
	src: imageUrl,
	loading: 'eager',
	format: 'webp'
});
---

<div
	class="relative w-full h-[300px] sm:h-[400px] lg:h-[var(--scrollable-background-height)] overflow-hidden touch-none cursor-grab active:cursor-grabbing scrollable-background-container"
	style={`--scrollable-background-height: ${height};`}
	role="img"
	aria-label={alt}
	data-scrollable
	data-scroll-sensitivity={scrollSensitivity}
>
	<!-- Custom Cursor - Always visible when mouse is over container -->
	<div
		class="z-50 fixed opacity-0 transition-opacity duration-200 pointer-events-none custom-cursor"
		data-custom-cursor
		style="left: -100px; top: -100px;"
	>
		<div
			class="flex justify-center items-center shadow-lg btn btn-circle btn-primary"
			data-cursor-circle
		>
			<svg
				class="w-5 h-5 transition-transform duration-300"
				viewBox="0 0 24 24"
				fill="currentColor"
				data-cursor-arrow
			>
				<path d="M12 20l-1.41-1.41L16.17 13H4v-2h12.17l-5.58-5.59L12 4l8 8z"></path>
			</svg>
		</div>
	</div>

	<div
		class="absolute bg-[length:100%_auto] bg-center w-full transition-transform duration-300 ease-out scrollable-background"
		style={`background-image: url(${optimizedBackground.src});`}
		data-image-height={optimizedBackground.attributes.height}
		data-image-width={optimizedBackground.attributes.width}
		data-scrollable-element
	>
	</div>
</div>

<style>
	:root {
		--scrollable-background-height: 600px;
	}

	.scrollable-background-container:hover .custom-cursor {
		opacity: 1 !important;
	}

	.custom-cursor {
		pointer-events: none;
		transform: translate(-50%, -50%);
		transition: opacity 0.2s ease-out;
	}

	.scrollable-background-container {
		cursor: none;
	}

	/* Ensure cursor is always on top */
	.custom-cursor {
		z-index: 9999;
	}

	/* Add subtle pulse animation to the cursor */
	@keyframes cursorPulse {
		0% {
			transform: translate(-50%, -50%) scale(1);
		}
		50% {
			transform: translate(-50%, -50%) scale(1.05);
		}
		100% {
			transform: translate(-50%, -50%) scale(1);
		}
	}

	.scrollable-background-container:hover .custom-cursor {
		animation: cursorPulse 2s infinite;
	}
</style>
