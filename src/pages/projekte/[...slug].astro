---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';

import Layout from '@layouts/PageLayout.astro';
import Glow from '@components/Ui/Glow.astro';
import ProjectNav from '@components/Project/ProjectNav.astro';
import DraggableBackground from '@components/Project/DraggableBackground.astro';
import ScrollableBackground from '@components/Project/ScrollableBackground.astro';

interface Props {
	project: CollectionEntry<'projects'>;
	nextProject: CollectionEntry<'projects'>;
	prevProject: CollectionEntry<'projects'>;
}

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
	const allProjects = await getCollection('projects');
	// get number of projects
	const numProjects = allProjects.length;
	allProjects.sort((a, b) => (a.data.date < b.data.date ? 1 : -1));

	return allProjects.map((project, index) => ({
		params: { slug: project.slug },
		props: {
			project,
			nextProject: allProjects[(index + 1) % numProjects],
			prevProject: allProjects[(index - 1 + numProjects) % numProjects]
		}
	}));
}

// 2. When it's time to render, you can get the entry directly from the prop
const { project, nextProject, prevProject } = Astro.props;
const { Content } = await project.render();

const meta = {
	title: project.data.title,
	description: project.data.description
};
---

<Layout {meta}>
	<div class="z-10 relative mx-auto px-4 pt-36 max-w-screen-xl">
		<Glow />

		<ProjectNav nextProject={nextProject} prevProject={prevProject} />

		<ScrollableBackground
			imageUrl={project.data.image as ImageMetadata}
			height="600px"
			alt={project.data.image_alt}
			scrollSensitivity={6.5}
		/>

		<div class="mx-auto pt-10 md:pt-20 max-w-6xl">
			<h1 class="pb-6 font-bold text-4xl sm:text-5xl md:text-7xl">{project.data.title}</h1>

			<div class="max-w-none prose-a:break-words prose lg:prose-lg">
				<Content />
			</div>
		</div>
	</div>
</Layout>
